<!doctype html><html>  <head>    <meta charset="utf-8">    <base href="../">    <title>JSDoc: source : app.js</title>    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">    <link href="css/site.css" type="text/css" rel="stylesheet">  </head>  <body ng-app="">    <nav id="toc">      <input placeholder="Filter" id="filter-input" class="col12 block field" type="text">      <div class="nav-wrapper">      <h2><a href="index.html">Index</a></h2>      <ul class="module">        <!-- undefined -->        <h2 class="module">          <a chref="" ng-click="moduleundefined = !moduleundefined">            module: undefined          </a>          <i ng-cloak="" ng-show="moduleundefined">+</i>        </h2>        <li id="undefined" ng-hide="moduleundefined">          <ul class="group">            <h2>              <a href="" ng-click="undefinedmodule = !undefinedmodule">                module              </a>              <i ng-cloak="" ng-show="undefinedmodule">+</i>            </h2>            <ul ng-hide="undefinedmodule">              <li>                <a href="app.html">app</a>              </li>            </ul>          </ul>        </li>      </ul><ul class="module">        <!-- app -->        <h2 class="module">          <a chref="" ng-click="moduleapp = !moduleapp">            module: app          </a>          <i ng-cloak="" ng-show="moduleapp">+</i>        </h2>        <li id="app" ng-hide="moduleapp">          <ul class="group">            <h2>              <a href="" ng-click="appfactory = !appfactory">                factory              </a>              <i ng-cloak="" ng-show="appfactory">+</i>            </h2>            <ul ng-hide="appfactory">              <li>                <a href="app.cep.html">cep</a>              </li><li>                <a href="app.CheckConditionService.html">CheckConditionService</a>              </li><li>                <a href="app.fipeService.html">fipeService</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="appconstant = !appconstant">                constant              </a>              <i ng-cloak="" ng-show="appconstant">+</i>            </h2>            <ul ng-hide="appconstant">              <li>                <a href="app.constants.html">constants</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="appservice = !appservice">                service              </a>              <i ng-cloak="" ng-show="appservice">+</i>            </h2>            <ul ng-hide="appservice">              <li>                <a href="app.conversorService.html">conversorService</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="appcontroller = !appcontroller">                controller              </a>              <i ng-cloak="" ng-show="appcontroller">+</i>            </h2>            <ul ng-hide="appcontroller">              <li>                <a href="app.CotacaoController.html">CotacaoController</a>              </li><li>                <a href="app.MainController.html">MainController</a>              </li><li>                <a href="app.PlacaController.html">PlacaController</a>              </li><li>                <a href="app.SemPlacaController.html">SemPlacaController</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="appdirective = !appdirective">                directive              </a>              <i ng-cloak="" ng-show="appdirective">+</i>            </h2>            <ul ng-hide="appdirective">              <li>                <a href="app.focusMe.html">focusMe</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="appconfig = !appconfig">                config              </a>              <i ng-cloak="" ng-show="appconfig">+</i>            </h2>            <ul ng-hide="appconfig">              <li>                <a href="app.RouteConfig.html">RouteConfig</a>              </li>            </ul>          </ul>        </li>      </ul>      </div>    </nav>    <div id="content" class="page-wrap">      <h1 class="title">        source : app.js      </h1>      <div id="main" class="big-container">        <!-- source code html -->        <article>          <pre class="prettyprint source linenums"><code>(function () {  'use strict';  /**   * @ngdoc module   * @scope {}   * @name app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Modulo principal da cotação.&lt;br>   *    * @param {module} ui.utils.masks     - Mascara para inputs {@link https://github.com/assisrafael/angular-input-masks}   * @param {module} ngAnimate          - Animação no angular {@link https://docs.angularjs.org/api/ngAnimate}   * @param {module} ui.router          - Rotas do Angular(troca de view) {@link https://github.com/angular-ui/ui-router}   * @param {module} ngMessages         - Alertas nos inputs {@link https://docs.angularjs.org/api/ngMessages/directive/ngMessages}   * @param {module} toaster            - Popup de mensagem {@link https://github.com/jirikavi/AngularJS-Toaster}   *    * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/module} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#startup-logic} Para melhores praticas   */  angular.module('app', [    'ui.utils.masks',    'ngAnimate',    'ui.router',    'ngMessages',    'toaster',    'templates',    'ui.mask'  ]);})();// TODO: Configurar cookie
(function () {  'use strict';  /**   * @ngdoc constant   * @scope {}   * @name constants   * @memberof app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Constantes do APP.   */  angular    .module('app')    .constant('api', 'https://multiplicarbrasil.com.br/sistemanovo/api.php/')    .constant('PagSeguroDirectPayment', PagSeguroDirectPayment)    .constant('projectDir', '')    .constant('projectDev', '')    .constant('rastreadorCarro', 20000)    .constant('rastreadorMoto', 7000)    .constant('anoCarro', 20)    .constant('anoMoto', 2005);})();
(function () {  'use strict';  angular    .module('app')    .config(RouteConfig);  RouteConfig.$inject = ['$stateProvider', '$locationProvider', '$urlRouterProvider'];  /**   * @ngdoc config   * @scope {}   * @name RouteConfig   * @memberof app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Controla as rotas do dashboard.&lt;br>   *    * @param {service} $stateProvider   * @param {service} $locationProvider   * @param {service} $urlRouterProvider   *    * @see Veja [Angular DOC]    {@link https://ui-router.github.io/ng1/} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#routing} Para melhores praticas   */  function RouteConfig($stateProvider, $locationProvider, $urlRouterProvider) {    $urlRouterProvider.otherwise('/');    $locationProvider.html5Mode(true);    $stateProvider      .state('placa', {        controller: 'PlacaController',        controllerAs: 'placa',        templateUrl: 'placa.html',        url: '/'      })      .state('fipe', {        controller: 'SemPlacaController',        controllerAs: 'placa',        templateUrl: 'fipe.html',        url: '/placa-nao-encontrada'      })      .state('cotacao', {        controller: 'CotacaoController',        controllerAs: 'cotacao',        templateUrl: 'cotacao.html',        url: '/cotacao'      })      .state('dados', {        controller: 'DadosPessoaisController',        controllerAs: 'dados',        templateUrl: 'dadosPessoais.html',        url: '/dados-pessoais'      })      .state('contrato', {        controller: 'ContratoController',        controllerAs: 'contrato',        templateUrl: 'contrato.html',        url: '/contrato'      })      .state('checkout', {        controller: 'CheckoutController',        controllerAs: 'checkout',        templateUrl: 'checkout.html',        url: '/checkout'      })      .state('resposta', {        controller: 'RespostaPagSeguroController',        controllerAs: 'resposta',        url: '/resposta-pagseguro'      });  }})();
(function () {  'use strict';  angular    .module('app')    .controller('CheckoutController', CheckoutController);  CheckoutController.$inject = ['$filter', '$http', '$rootScope', '$state', 'api', 'consultCEP', 'conversorService', 'PagSeguroDirectPayment', 'projectDev', 'toaster'];  function CheckoutController($filter, $http, $rootScope, $state, api, consultCEP, conversorService, PagSeguroDirectPayment, projectDev, toaster) {    var vm = this;    var token = '';    var requisicao = {      'email': '',      'token': '',      'paymentMode': 'default',      'paymentMethod': 'creditCard',      'receiverEmail': '',      'currency': 'BRL',      'extraAmount': '',      'itemId1': '',      'itemDescription1': '',      'itemAmount1': '',      'itemQuantity1': '1',      'notificationURL': '',      'reference': '',      'senderName': '',      'senderCPF': '',      'senderAreaCode': '',      'senderPhone': '',      'senderEmail': '',      'senderHash': '',      'shippingAddressStreet': '',      'shippingAddressNumber': '',      'shippingAddressComplement': '',      'shippingAddressDistrict': '',      'shippingAddressPostalCode': '',      'shippingAddressCity': '',      'shippingAddressState': '',      'shippingAddressCountry': 'BRA',      'shippingType': '',      'shippingCost': '',      'creditCardToken': '',      'installmentQuantity': '1',      'installmentValue': '',      'creditCardHolderName': '',      'creditCardHolderCPF': '',      'creditCardHolderBirthDate': '',      'creditCardHolderAreaCode': '',      'creditCardHolderPhone': '',      'billingAddressStreet': '',      'billingAddressNumber': '',      'billingAddressComplement': '',      'billingAddressDistrict': '',      'billingAddressPostalCode': '',      'billingAddressCity': '',      'billingAddressState': '',      'billingAddressCountry': 'BRA'    };    vm.acceptedCreditCard = [];    vm.aniversario = '';    vm.carregando = true;    vm.cardDados = {      'cardNumber': '',      'brand': '',      'cvv': '',      'expirationMonth': '',      'expirationYear': '',      'success': '',      'error': ''    };    vm.cardToken = '';    vm.expericaoCartao = '';    vm.hasBrand = false;    vm.hasPaid = false;    vm.imgBrand = '';    vm.usuario = {      'bairro': '',      'cep': '',      'cidade': '',      'complemento': '',      'cpf': '',      'email': '',      'estado': '',      'logradouro': '',      'nome': '',      'numero': '',      'telefone': ''    };    vm.validador = undefined;    vm.CreateCardToken = CreateCardToken;    vm.GetBrand = GetBrand;    vm.GetCep = GetCep;    Activate();    ////////////////    function Activate() {      if (!$rootScope.usuario) {        $state.go('placa');      } else {        GetDadosUsuario();        console.log('Globas => ', $rootScope);        $http.get(projectDev + 'php/getID.php').then(function (resp) {          var retorno = $.parseXML(resp.data);          token = $(retorno).find('id')[0].textContent || null;          console.log('Retorno => ', retorno);          console.log('ID =>', token);          if (token) {            vm.carregando = false;            PagSeguroDirectPayment.setSessionId(token);            GetMeiosPagamento();          } else {            console.warn('Pagseguro retornou null');            toaster.pop({              type: 'error',              title: 'Erro #801',              body: 'Não foi possível completar a requisição.',              timeout: 50000            });          }        }).catch(function (error) {          toaster.pop({            type: 'error',            title: 'Erro #702',            body: 'Não foi possível completar a requisição.',            timeout: 50000          });          console.warn('Erro ao buscar dados do pagseguro = >' + error);        });      }    }    function CheckErrosCartao(erros) {      var lista = [];      erros = conversorService.Xml2Json(erros);      erros = erros.replace('undefined', '');      erros = JSON.parse(erros);      angular.forEach(erros.errors.error, function (value, key) {        if (!lista.includes(value.code)) {          switch (value.code) {            case '53019' || '53050':              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'DDD inválido.',                timeout: 50000              });              lista.push('53019');              lista.push('53050');              break;            case '5003':              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'Falha de comunicação com a instituição financeira.',                timeout: 50000              });              lista.push('5003');              break;            case '10001':              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'Número do cartão de crédito inválido.',                timeout: 50000              });              lista.push('10001');              break;            case '10002':              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'Data inválida',                timeout: 50000              });              lista.push('10002');              break;            case '53010' || '53011' || '53012':              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'E-mail inválido',                timeout: 50000              });              lista.push('53011');              lista.push('53012');              lista.push('53010');              break;            case '53034' || '53065':              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'Estado inválido.',                timeout: 50000              });              lista.push('53034');              lista.push('53065');              break;            case '53015' || '53044' :              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'Por favor, digite o nome completo.',                timeout: 50000              });              lista.push('53015');              lista.push('53044');              break;            case '53046' || '53017':              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'Por favor, digite um CPF válido',                timeout: 50000              });              lista.push('53046');              lista.push('53017');              break;            default:              toaster.pop({                type: 'error',                title: 'Erro ao enviar os dados',                body: 'Verifique os dados e tente novamente. Em caso de dúvidas, por favor, entre em contato com a gente.',                timeout: 50000              });              break;          }        }      });      vm.carregando = false;    }    function CreateCardToken() {      vm.carregando = true;      vm.cardDados.expirationMonth = $filter('date')(vm.expericaoCartao, 'MM');      vm.cardDados.expirationYear = $filter('date')(vm.expericaoCartao, 'yyyy');      console.log('Dados do cartao =>', vm.cardDados);      vm.cardDados.success = function (resp) {        console.log('CreateCardToken =>', resp);        requisicao.creditCardToken = resp.card.token;        PagarCreditCard();      };      vm.cardDados.error = function (resp) {        vm.carregando = false;        console.warn('CreateCardToken =>', resp);        toaster.pop({          type: 'error',          title: 'Erro com o cartão',          body: 'Cartão inválido.',          timeout: 50000        });      };      console.log('Dados do cartao =>', vm.cardDados);      PagSeguroDirectPayment.createCardToken(vm.cardDados);    }    function EnviarEmail() {      // TODO: Enviar email de confirmacao de pagamento    }    function GetBrand() {      if (vm.cardDados.cardNumber.length >= 6) {        PagSeguroDirectPayment.getBrand({          cardBin: vm.cardDados.cardNumber,          success: function (resp) {            console.log('Brand => ', resp);            /**             * O nome do cartao eh importante para saber se ele eh aceitou ou nao             * O nome do cartao na lista acceptedCreditCard esta em uppercase             * Portanto eh preciso alterar o nome             */            var cartaoNome = resp.brand.name;            cartaoNome = cartaoNome.toUpperCase();            vm.cardDados.brand = resp.brand.name;            console.log('Brand name => ', cartaoNome);            // Verifica se essa cartao eh aceito pelo Pagseguro            var cartaoValid = vm.acceptedCreditCard[cartaoNome].status;            console.log(' Status Cartao  => ', cartaoValid);            if (cartaoValid === 'AVAILABLE') {              console.info('Cartao Valido');              vm.hasBrand = true; // Mostra os campos restantes do cartao              vm.imgBrand = {                'background-image': 'url(https://stc.pagseguro.uol.com.br' + vm.acceptedCreditCard[cartaoNome].images.MEDIUM.path + ')'              }; // Imagem do cartao              vm.validador = resp.brand; // Configuracoes dos inputs de data e codigo de seguranca            } else {              vm.hasBrand = false;            }          },          error: function (resp) {            vm.hasBrand = false;            toaster.pop({              type: 'error',              title: 'Erro #801',              body: 'Não foi possível completar a requisição.',              timeout: 50000            });            console.warn('Erro ao pegar o brand => ', resp);          }        });      }    }    function GetCep() {      if (vm.usuario.cep.length > 10) {        consultCEP.consultar(vm.usuario.cep).then(function (resp) {          console.log('CEP =>', resp);          vm.usuario.bairro = resp.bairro;          vm.usuario.cidade = resp.cidade;          vm.usuario.estado = resp.estado;          vm.usuario.logradouro = resp.logradouro;        }).catch(function (error) {          console.warn('Erro no cep = >', error);        });      }    }    function GetDadosUsuario() {      $http.get(api + 'cliente/' + $rootScope.usuario.idUsuario).then(function (resp) {        console.log('cliente => ', resp);        vm.usuario = resp.data;        console.log('usuario => ', vm.usuario);      });    }    function GetMeiosPagamento() {      PagSeguroDirectPayment.getPaymentMethods({        amount: 100,        success: function (response) {          //meios de pagamento disponíveis            console.log('Meios de pagamento =>', response);          vm.acceptedCreditCard = response.paymentMethods.CREDIT_CARD.options;        },        error: function (response) {          console.warn('Erro ao pegar os meios de pagamento => ', response);          toaster.pop({            type: 'error',            title: 'Erro #801',            body: 'Não foi possível completar a requisição.',            timeout: 50000          });        }      });    }    function PagarCreditCard() {      var tel = vm.usuario.telefone;      // Dados do plano      requisicao.itemId1 = $rootScope.usuario.idCotacao;      requisicao.itemDescription1 = 'Adesão do plano ' + $rootScope.usuario.plano + '. Para o modelo ' + $rootScope.usuario.modelo;      requisicao.itemAmount1 = requisicao.installmentValue = ($filter('number')($rootScope.usuario.vlorAdesao, 2)).replace(',', '.');      requisicao.reference = $rootScope.usuario.idUsuario;      // Dados do comprador      requisicao.senderName = requisicao.creditCardHolderName = vm.usuario.nome;      requisicao.senderCPF = requisicao.creditCardHolderCPF = vm.usuario.cpf;      requisicao.senderAreaCode = requisicao.creditCardHolderAreaCode = tel.substring(0, 2);      requisicao.senderPhone = requisicao.creditCardHolderPhone = tel.slice(2);      requisicao.senderEmail = vm.usuario.email;      requisicao.senderHash = PagSeguroDirectPayment.getSenderHash();      requisicao.creditCardHolderBirthDate = $filter('date')(vm.aniversario, 'dd/MM/yyyy');      //Endereco      requisicao.shippingAddressStreet = requisicao.billingAddressStreet = vm.usuario.logradouro;      requisicao.shippingAddressNumber = requisicao.billingAddressNumber = vm.usuario.numero;      requisicao.shippingAddressComplement = requisicao.billingAddressComplement = vm.usuario.complemento;      requisicao.shippingAddressDistrict = requisicao.billingAddressDistrict = vm.usuario.bairro;      requisicao.shippingAddressPostalCode = requisicao.billingAddressPostalCode = vm.usuario.cep;      requisicao.shippingAddressCity = requisicao.billingAddressCity = vm.usuario.cidade;      requisicao.shippingAddressState = requisicao.billingAddressState = vm.usuario.estado.toUpperCase();      console.log('Requisisao => ', requisicao);      $http({        method: 'POST',        headers: {          'Content-Type': 'charset=ISO-8859-1'        },        data: requisicao,        url: projectDev + 'php/pagar.php'      }).then(function (resp) {        var retorno = $.parseXML(resp.data);        console.log('Resposta pagamento cartao =>', resp);        console.log(retorno);        var transacao = {          'cliente': '',          'codigo': '',          'criacao': '',          'descricao': '',          'pagamento': '',          'status': '',          'valor': ''        };        var erros = $(retorno).find('errors').find('error') || null;        if (erros.length > 0) {          console.warn('Erros => ', erros);          CheckErrosCartao(resp.data);        } else {          var status = '';          var hoje = new Date();          var pagamento = '';          switch ($(retorno).find('transaction').find('status')[0].textContent) {            case '1':              status = 'Aguardando pagamento';              break;            case '2':              status = 'Em análise';              break;            case '3':              status = 'Paga';              $http.post('php/emailTransacao.php', {                'id': $(retorno).find('transaction').find('reference')[0].textContent              });              break;            case '4':              status = 'Disponível';              break;            case '5':              status = 'Em disputa';              break;            case '6':              status = 'Devolvida';              break;            case '7':              status = 'Cancelada';              break;            case '8':              status = 'Debitado';              break;            case '9':              status = 'Retenção temporária';              break;            default:              break;          }          switch ($(retorno).find('transaction').find('paymentMethod').find('type')[0].textContent) {            case '1':              pagamento = 'Cartão de crédito';              break;            case '2':              pagamento = 'Boleto';              break;            default:              break;          }          transacao.cliente = $(retorno).find('transaction').find('reference')[0].textContent || null;          transacao.codigo = $(retorno).find('transaction').find('code')[0].textContent || null;          transacao.criacao = $filter('date')(hoje, 'yyyy-MM-dd HH:mm:ss', '+0300');          transacao.descricao = $(retorno).find('transaction').find('items').find('item').find('description')[0].textContent || null;          transacao.pagamento = pagamento;          transacao.status = status;          transacao.valor = $(retorno).find('transaction').find('items').find('item').find('amount')[0].textContent || null;          $http.post(api + 'transacao', transacao).then(function (resp) {            vm.carregando = false;            vm.hasPaid = true;          }).catch(function (error) {            vm.carregando = false;            vm.hasPaid = true;            //TODO: Enviar um email para o admin avisando            console.warn('Erro ao salvar no BD = >' + error);          });        }      }).catch(function (error) {        vm.carregando = false;        toaster.pop({          type: 'error',          title: 'Pagamento não realizado #801',          body: 'Erro ao realizar o pagamento. Por favor,tente novamente mais tarde.',          timeout: 50000        });        console.warn('Erro ao pagar = >' + error);      });    }  }})();
(function () {  'use strict';  angular    .module('app')    .controller('ContratoController', ContratoController);  ContratoController.$inject = ['$http', '$rootScope', '$state', 'api'];  function ContratoController($http, $rootScope, $state, api) {    var vm = this;    vm.Contratar = Contratar;    Activate();    ////////////////    function Activate() {      console.log($rootScope);      if (!$rootScope.usuario) {        $state.go('placa');      }    }    function Contratar() {      $state.go('checkout');    }  }})();
(function () {  'use strict';  angular    .module('app')    .controller('CotacaoController', CotacaoController);  CotacaoController.$inject = ['$filter', '$http', '$rootScope', '$state', 'api', 'rastreadorCarro', 'rastreadorMoto', 'toaster', 'projectDir', 'projectDev'];  /**   * @ngdoc controller   * @scope {}   * @name CotacaoController   * @memberof app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Mostra o resultado da cotação   *   * @property {object} vm                - A named variable for the `this` keyword representing the ViewModel   * @property {string} vm.adesao         - Valor da adesao   * @property {string} vm.carregando     - Controla o loading   * @property {string} vm.cotacao        - Dados da cotacao   * @property {string} vm.email          - E-mail do usuario   * @property {string} vm.envelope       - Dados para enviar por e-mail   * @property {string} vm.franquia       - Valor da franquia   * @property {string} vm.hasRastreador  - Controla se tem ou nao rastreador   * @property {string} vm.planoEscolhido - Plano que o usuario escolheu   * @property {string} vm.preco          - Precos dos planos   * @property {string} vm.opcionais      - Opcionais do carro   * @property {string} vm.opcionaisMoto  - Opcionais da moto   * @property {string} vm.opcionaisPopup - Url do popup dos opcionais   * @property {string} vm.valorFipe      - Valor na tabela fipe do veiculo   * @property {string} vm.total          - Total da menalidade (valor do plano + opcionais)   *   * @param {service}  $filter          - Usado para formatação {@link https://docs.angularjs.org/api/ng/filter/filter}   * @param {service}  $http            - Usado para comunicação HTTP {@link https://docs.angularjs.org/api/ng/service/$http}   * @param {service}  $rootScope       - Escopo principal do angular {@link https://docs.angularjs.org/api/ng/service/$rootScope}   * @param {service}  $state           - Status da transição {@link https://github.com/angular-ui/ui-router/wiki/Quick-Reference#state-1}   * @param {constant} api              - Url do api   * @param {constant} rastreadorCarro  - Valor minimo para ter rastreador obrigatorio no carro   * @param {constant} rastreadorMoto   - Valor minimo para ter rastreador obrigatorio na moto   * @param {service}  toaster          - Seviço para mostrar mensagens   * @param {constant} projectDir       - Caminho para o diretorio de producao   * @param {constant} projectDev       - Caminho para o diretorio de desenvolvimento   *    * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   */  function CotacaoController($filter, $http, $rootScope, $state, api, rastreadorCarro, rastreadorMoto, toaster, projectDir, projectDev) {    var vm = this;    vm.adesao     = '';    vm.carregando = true;    vm.cotacao    = {      'adesao'    : '',      'fabricante': '',      'fipe'      : '',      'franquia'  : '',      'ip'        : '',      'modelo'    : '',      'tipo'      : 'Comum',      'valor'     : '',      'veiculo'   : ''    };    vm.email    = undefined;    vm.envelope = {      'adesao'     : '',      'check'      : 'umapalavrarealmentemuitograndeparaserlembradafeitapormim',      'franquia'   : '',      'modelo'     : '',      'to'         : '',      'valorBronze': '',      'valorCarro' : '',      'valorOuro'  : '',      'valorPrata' : ''    };    vm.franquia       = '';    vm.hasRastreador  = false;    vm.planoEscolhido = 'basico';    vm.preco          = {      basico: 29.90,      bronze: undefined,      ouro  : undefined,      prata : undefined    };    vm.opcionais = {      'carroReserva': 0.00,      'rastreador'  : 0.00,      'reboque'     : 0.00,      'vidros'      : 0.00    };    vm.opcionaisMoto = {      'hospital'   : false,      'motoReserva': '',      'seguro'     : false,      'vidros'     : 0.0    };    vm.opcionaisPopup = 'opcionais.html';    vm.valorFipe      = undefined;    vm.total          = 0.00;    /**     * Atribuição das funções no escopo     */    vm.Contratar       = Contratar;    vm.EnviarEmail     = EnviarEmail;    vm.LimparOpcionais = LimparOpcionais;    vm.SomarTotal      = SomarTotal;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof CotacaoController     */    function Activate() {      //Se nao houver dados do carro, envia de volta para a tela para digitar a placa      if (!$rootScope.usuario) {        $state.go('placa');      } else {        GetPrecos();      }    }    /**     * @function AdicionarOpcionais     * @desc Adiciona os nomes dos opcionais na variavel que vai para o bd     * @memberof CotacaoController     */    function AdicionarOpcionais(planoEscolhido) {      if (vm.opcionaisMoto.motoReserva === 9.00) {        planoEscolhido.opcionais += 'Moto reserva 7 dias, ';      } else if (vm.opcionaisMoto.motoReserva === 15.00) {        planoEscolhido.opcionais += 'Moto reserva 20 dias, ';      }      if (vm.opcionaisMoto.motoReserva !== 0.00) {        planoEscolhido.opcionais += 'Vidros faróis retrovisores, ';      }      if (vm.opcionais.carroReserva === 7.00) {        planoEscolhido.opcionais += 'Carro reserva 7 dias, ';      } else if (vm.opcionais.carroReserva === 15.00) {        planoEscolhido.opcionais += 'Carro reserva 15 dias, ';      } else if (vm.opcionais.carroReserva === 30.00) {        planoEscolhido.opcionais += 'Carro reserva 30 dias, ';      }      if (vm.opcionais.rastreador !== 0.00) {        planoEscolhido.opcionais += 'Rastreador e Bloqueador, ';      }      if (vm.opcionais.reboque !== 0.00) {        planoEscolhido.opcionais += 'Reboque 1000Km, ';      }      if (vm.opcionais.vidros !== 0.00) {        planoEscolhido.opcionais += 'Vidros faróis retrovisores';      }    }    /**     * @function BuscarPrecoCarro     * @desc Busca os valores da cotação para carro     * @memberof CotacaoController     */    function BuscarPrecoCarro() {      //Busca os dados dos planos no BD      $http.get(api + 'precocarro').then(function (resp) {        var valores = php_crud_api_transform(resp.data).precocarro;        //Pega o valor de cada plano        angular.forEach(valores, function (value, key) {          if (vm.valorFipe >= parseInt(value.min) && vm.valorFipe &lt;= parseInt(value.max)) {            console.log(value);            switch (value.plano) {              case 'Bronze':                vm.adesao               = value.adesao;                vm.franquia             = value.franquia;                vm.preco.bronze         = parseFloat(value.valor);                vm.envelope.adesao      = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia    = value.franquia;                vm.envelope.valorBronze = $filter('currency')(value.valor, 'R$ ');                break;              case 'Prata':                vm.adesao              = value.adesao;                vm.franquia            = value.franquia;                vm.preco.prata         = parseFloat(value.valor);                vm.envelope.adesao     = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia   = value.franquia;                vm.envelope.valorPrata = $filter('currency')(value.valor, 'R$ ');                break;              case 'Ouro':                vm.adesao             = value.adesao;                vm.franquia           = value.franquia;                vm.preco.ouro         = parseFloat(value.valor);                vm.envelope.adesao    = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia  = value.franquia;                vm.envelope.valorOuro = $filter('currency')(value.valor, 'R$ ');                break;              default:                break;            }          }        });        console.log('Adesao => ',   vm.adesao);        console.log('Franquia => ', vm.franquia);        console.log('Preco => ',    vm.preco);        console.log('Envelope => ', vm.envelope);        CotacaoLimite();        vm.carregando = false;      }).catch(function (error) {         toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao buscar preco do carro = >' + error);        $state.go('placa');      });    }    /**     * @function BuscarPrecoEspecial     * @desc Busca os valores da cotação para especial     * @memberof CotacaoController     */    function BuscarPrecoEspecial() {      //Busca os dados dos planos no BD      $http.get(api + 'precoespecial').then(function (resp) {        var valores = php_crud_api_transform(resp.data).precoespecial;        //Pega o valor de cada plano        angular.forEach(valores, function (value, key) {          if (vm.valorFipe >= parseInt(value.min) && vm.valorFipe &lt;= parseInt(value.max)) {            console.log(value);            switch (value.plano) {              case 'Bronze':                vm.adesao               = value.adesao;                vm.franquia             = value.franquia;                vm.preco.bronze         = parseFloat(value.valor);                vm.envelope.adesao      = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia    = value.franquia;                vm.envelope.valorBronze = $filter('currency')(value.valor, 'R$ ');                break;              case 'Prata':                vm.adesao              = value.adesao;                vm.franquia            = value.franquia;                vm.preco.prata         = parseFloat(value.valor);                vm.envelope.adesao     = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia   = value.franquia;                vm.envelope.valorPrata = $filter('currency')(value.valor, 'R$ ');                break;              case 'Ouro':                vm.adesao             = value.adesao;                vm.franquia           = value.franquia;                vm.preco.ouro         = parseFloat(value.valor);                vm.envelope.adesao    = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia  = value.franquia;                vm.envelope.valorOuro = $filter('currency')(value.valor, 'R$ ');                break;              default:                break;            }          }        });        console.log('Adesao => ',   vm.adesao);        console.log('Franquia => ', vm.franquia);        console.log('Preco => ',    vm.preco);        console.log('Envelope => ', vm.envelope);        CotacaoLimite();        vm.carregando = false;      }).catch(function (error) {         toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao buscar preco do especial = >' + error);        $state.go('placa');      });    }    /**     * @function BuscarPrecoMoto     * @desc Busca os valores da cotação para moto     * @memberof CotacaoController     */    function BuscarPrecoMoto() {      //Busca os dados dos planos no BD      $http.get(api + 'precomoto').then(function (resp) {        var valores = php_crud_api_transform(resp.data).precomoto;        //Pega o valor de cada plano        angular.forEach(valores, function (value, key) {          if (vm.valorFipe >= parseInt(value.min) && vm.valorFipe &lt;= parseInt(value.max)) {            console.log(value);            switch (value.plano) {              case 'Bronze':                vm.adesao               = value.adesao;                vm.franquia             = value.franquia;                vm.preco.bronze         = parseFloat(value.valor);                vm.envelope.adesao      = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia    = value.franquia;                vm.envelope.valorBronze = $filter('currency')(value.valor, 'R$ ');                break;              case 'Prata':                vm.adesao              = value.adesao;                vm.franquia            = value.franquia;                vm.preco.prata         = parseFloat(value.valor);                vm.envelope.adesao     = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia   = value.franquia;                vm.envelope.valorPrata = $filter('currency')(parseFloat(value.valor), 'R$ ');                break;              case 'Ouro':                vm.adesao             = value.adesao;                vm.franquia           = value.franquia;                vm.preco.ouro         = parseFloat(value.valor);                vm.envelope.adesao    = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia  = value.franquia;                vm.envelope.valorOuro = $filter('currency')(value.valor, 'R$ ');                break;              default:                break;            }          }        });        console.log('Adesao => ',   vm.adesao);        console.log('Franquia => ', vm.franquia);        console.log('Preco => ',    vm.preco);        console.log('Envelope => ', vm.envelope);        CotacaoLimite();        vm.carregando = false;      }).catch(function (error) {         toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao buscar preco da moto = >' + error);        $state.go('placa');      });    }    /**     * @function BuscarPrecoTaxi     * @descBusca os valores da cotação para taxi     * @memberof CotacaoController     */    function BuscarPrecoTaxi() {      //Busca os dados dos planos no BD      $http.get(api + 'precotaxi').then(function (resp) {        var valores = php_crud_api_transform(resp.data).precotaxi;        //Pega o valor de cada plano        angular.forEach(valores, function (value, key) {          if (vm.valorFipe >= parseInt(value.min) && vm.valorFipe &lt;= parseInt(value.max)) {            console.log(value);            switch (value.plano) {              case 'Bronze':                vm.adesao               = value.adesao;                vm.franquia             = value.franquia;                vm.preco.bronze         = parseFloat(value.valor);                vm.envelope.adesao      = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia    = value.franquia;                vm.envelope.valorBronze = $filter('currency')(value.valor, 'R$ ');                break;              case 'Prata':                vm.adesao              = value.adesao;                vm.franquia            = value.franquia;                vm.preco.prata         = parseFloat(value.valor);                vm.envelope.adesao     = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia   = value.franquia;                vm.envelope.valorPrata = $filter('currency')(value.valor, 'R$ ');                break;              case 'Ouro':                vm.adesao             = value.adesao;                vm.franquia           = value.franquia;                vm.preco.ouro         = parseFloat(value.valor);                vm.envelope.adesao    = $filter('currency')(value.adesao, 'R$ ');                vm.envelope.franquia  = value.franquia;                vm.envelope.valorOuro = $filter('currency')(value.valor, 'R$ ');                break;              default:                break;            }          }        });        console.log('Adesao => ',   vm.adesao);        console.log('Franquia => ', vm.franquia);        console.log('Preco => ',    vm.preco);        console.log('Envelope => ', vm.envelope);        CotacaoLimite();        vm.carregando = false;      }).catch(function (error) {         toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao buscar preco do taxi = >' + error);        $state.go('placa');      });    }    /**     * @function CotacaoLimite     * @desc Executa quando o valor atinge o limite da tabela     * @memberof CotacaoController     */    function CotacaoLimite() {      if (!vm.preco.ouro) {        console.warn('Valor da tabela fipe acima do limite', vm.preco);        toaster.pop({          type   : 'info',          body   : 'Não é possível fazer cotação para esse veículo.',          timeout: 50000        });        $state.go('placa');      }    }    /**     * @function Contratar     * @desc Salva as informações da cotacao, o plano escolhido e os opcionais.     * Depois envio o usuario para digitar os dados pessoais     * @memberof CotacaoController     */    function Contratar() {      vm.carregando = true;      $('.bs-example-modal-lg').modal('hide');      $('.modal-backdrop').css('display','none');      $('body').removeClass('modal-open').css('padding-right','0');      var planoEscolhido = {        'adesao'     : $filter('currency')(vm.adesao, 'R$ '),        'cotacao'    : $rootScope.usuario.idCotacao,        'franquia'   : vm.franquia,        'fipe'       : $rootScope.usuario.codigoTabelaFipe,        'ip'         : vm.cotacao.ip,        'plano'      : vm.planoEscolhido,        'modelo'     : $rootScope.usuario.modelo,        'opcionais'  : '',        'tipoVeiculo': vm.cotacao.tipo,        'veiculo'    : vm.cotacao.veiculo,        'mensalidade': $filter('currency')(vm.total, 'R$ ')      };      AdicionarOpcionais(planoEscolhido);      $rootScope.usuario.plano      = vm.planoEscolhido;      $rootScope.usuario.vlorAdesao = vm.adesao;      $rootScope.usuario.valorPlano = vm.total;       $http.post(api + 'planoescolhido', planoEscolhido).then(function (resp) {        console.info('Plano escolhido salvo ', planoEscolhido);        $rootScope.usuario.idPlano = resp.data;        vm.carregando = false;        $state.go('dados');      }).catch(function (error) {        toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Por favor, tente mais tarde.',          timeout: 50000        });        vm.carregando = false;        console.warn('Não foi possivel salvar o plano escolhido = >', error);      });    }    /**     * @function EnviarEmail     * @desc Envia a cotação para o e-mail fornecido     * @memberof CotacaoController     */    function EnviarEmail() {      console.info('Email enviado.');      toaster.pop({        type   : 'success',        body   : 'E-mail enviado.',        timeout: 30000      });      vm.envelope.to = vm.email;      vm.email = undefined;      $http.post(projectDir + 'php/emailCotacao.php', vm.envelope).catch(function (error) {        console.warn('Não foi possivel enviar e-mail = >', error);      });    }    /**     * @function GetPrecos     * @desc Busca o valor dos planos no banco de dados baseado no valor da tabela fipe     * @memberof CotacaoController     */    function GetPrecos() {      /**       * Retira o R$ e o ,00 do valor para ficar mais facil a verificação       * abaixo       */      vm.valorFipe = $rootScope.usuario.preco.replace('R$ ', ' ');      vm.valorFipe = vm.valorFipe.replace(',00', ' ');      vm.valorFipe = parseInt(vm.valorFipe);      //Formata o valor da tabela FIPE      $rootScope.usuario.preco = $filter('currency')(vm.valorFipe, 'R$ ');      //Armazena o valor da fipe e o modelo do carro na variavel para enviar pro email      vm.envelope.valorCarro = $rootScope.usuario.preco;      vm.envelope.modelo     = $rootScope.usuario.modelo;      /**       * Verifica se eh carro ou moto.       * Se for carro verifica se eh taxi ou uber       * Verfica se o rastredor eh obrigatorio ou nao       */      if ($rootScope.usuario.veiculo === 'AUTOMOVEL') {        vm.cotacao.veiculo = 'Carro';        //Rastreador        if (vm.valorFipe > rastreadorCarro) {          console.info('Rastreador');          vm.hasRastreador = true;        }        if ($rootScope.usuario.taxi) {          console.info('Taxi');          vm.cotacao.tipo    = 'Taxi';          BuscarPrecoTaxi();        } else if ($rootScope.usuario.disel) {          console.info('Disel');          vm.cotacao.tipo    = 'Disel';          BuscarPrecoEspecial();        } else if ($rootScope.usuario.importado) {          console.info('Importado');          vm.cotacao.tipo    = 'Importado';          BuscarPrecoEspecial();        } else {          console.info('Carro');          BuscarPrecoCarro();        }      } else {        console.info('Moto');        vm.cotacao.veiculo = 'Moto';        if (vm.valorFipe > rastreadorMoto) {          console.info('Rastreador');          vm.hasRastreador = true;        }        BuscarPrecoMoto();      }      SalvarCotacao();    }    /**     * @function LimparOpcionais     * @desc Limpa as escolhas feitas nos opcionais quando troca de plano     * @memberof CotacaoController     */    function LimparOpcionais() {      vm.opcionais = {        'carroReserva': 0.00,        'rastreador'  : 0.00,        'reboque'     : 0.00,        'vidros'      : 0.00      };      vm.opcionaisMoto = {        'hospital'   : false,        'motoReserva': 0.00,        'seguro'     : false,        'vidros'     : 0.00      };      vm.total =  vm.preco[vm.planoEscolhido];    }    /**     * @function SalvarCotacao     * @desc Salva os dados da cotação no banco de dados     * @memberof CotacaoController     */    function SalvarCotacao() {      $http.get(projectDev + 'php/ipvisitor.php').then(function (resp) {        // Salva as informacoes para enviar para o BD        vm.cotacao.fipe     = $rootScope.usuario.codigoTabelaFipe;        vm.cotacao.ip       = resp.data || null;        vm.cotacao.modelo   = $rootScope.usuario.modelo;        vm.cotacao.valor    = $rootScope.usuario.preco;        console.log('Cotacao =>', vm.cotacao);        console.log('Usuario =>', $rootScope.usuario);        //Salva no Banco de dados        $http.post(api + 'cotacao', vm.cotacao).then(function (resp) {          console.info('Cotação salva');          $rootScope.usuario.idCotacao = resp.data;        }).catch(function (error) {          console.warn('Erro ao pegar ip do usuario = >' + error);        });      }).catch(function (error) {        toaster.pop({          type   : 'error',          title  : 'Erro ao conectar com o servidor #702',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao salvar cotacao = >' + error);        $state.go('placa');      });    }    function SalvarPepidrive() {      //TODO: Salvar no pepidrive    }    /**     * @function SomarTotal     * @desc Soma o valor do plano escolhido com os opcionais escolhidos     * @memberof CotacaoController     */    function SomarTotal() {      /**       * Reseta o valor do total baseado no plano       * Evita erro quando o usuario troca de plano       */      vm.total =  vm.preco[vm.planoEscolhido];      vm.total +=        vm.opcionaisMoto.vidros +        vm.opcionaisMoto.motoReserva +        vm.opcionais.carroReserva +        vm.opcionais.vidros +        vm.opcionais.reboque +        vm.opcionais.rastreador;        console.log(vm.opcionaisMoto.vidros);        console.log(vm.opcionaisMoto.motoReserva);        console.log(vm.opcionais.carroReserva);        console.log(vm.opcionais.vidros);        console.log(vm.opcionais.rastreador);        console.log(vm.total);    }  }})();
(function () {  'use strict';  angular    .module('app')    .controller('DadosPessoaisController', DadosPessoaisController);  DadosPessoaisController.$inject = ['$http', '$rootScope', '$state', 'api', 'consultCEP', 'toaster'];  /**   * @ngdoc controller   * @scope {}   * @name CotacaoController   * @memberof app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Armazena os dados pessoais do cliente   *   * @property {object} vm            - A named variable for the `this` keyword representing the ViewModel   * @property {string} vm.carregando - Controla o loading   * @property {string} vm.passo      - Dados do veiculo da cotacao   * @property {string} vm.usuario    - Dados do usuario   *   * @param {service}  $http      - Usado para comunicação HTTP {@link https://docs.angularjs.org/api/ng/service/$http}   * @param {service}  $rootScope - Escopo principal do angular {@link https://docs.angularjs.org/api/ng/service/$rootScope}   * @param {service}  $state     - Status da transição {@link https://github.com/angular-ui/ui-router/wiki/Quick-Reference#state-1}   * @param {constant} api        - Url do api   * @param {service}  consultCEP - Servico para consultar cep   * @param {toaster}  toaster    - Serviço de mensagem popup   *   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   */  function DadosPessoaisController($http, $rootScope, $state, api, consultCEP, toaster) {    var vm = this;    vm.carregando = false;    vm.passo      = 'nome';    vm.usuario = {      'bairro':         '',      'cep':            '',      'cidade':         '',      'complemento':    '',      'cotacao':        '',      'cpf':            '',      'email':          '',      'estado':         '',      'logradouro':     '',      'nome':           '',      'numero':         '',      'planoEscolhido': '',      'telefone':       ''    };    /**     * Atribuição das funções no escopo     */    vm.GetCep      = GetCep;    vm.SalvarDados = SalvarDados;    Activate();    ////////////////    function Activate() {      if (!$rootScope.usuario) {        $state.go('placa');      }else{        vm.usuario.cotacao        = $rootScope.usuario.idCotacao;        vm.usuario.planoEscolhido = $rootScope.usuario.idPlano;      }    }    function GetCep() {      consultCEP.consultar(vm.usuario.cep).then(function (resp) {        console.log('CEP =>', resp);        vm.usuario.bairro     = resp.bairro;        vm.usuario.cidade     = resp.cidade;        vm.usuario.estado     = resp.estado;        vm.usuario.logradouro = resp.logradouro;      }).catch(function (error) {        console.warn('Erro no cep = >', error);      });    }    function SalvarDados() {      $http.post(api + 'cliente', vm.usuario).then(function (resp) {        $rootScope.usuario.idUsuario = resp.data;        console.info('Dados salvos ',$rootScope.usuario);        $state.go('contrato');      }).catch(function (error) {        toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao salvar dados do usuario = >' + error);        $state.go('placa');      });    }  }})();
(function () {  'use strict';  angular    .module('app')    .controller('MainController', MainController);  MainController.$inject = ['$location', '$anchorScroll', 'projectDir', '$window'];  /**   * @ngdoc controller   * @scope {}   * @name MainController   * @memberof app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Controle principal da cotação.   *    * @property {object} vm            - A named variable for the `this` keyword representing the ViewModel   * @property {string} vm.directory  - Caminho do diretorio do sistema   * @property {string} vm.telefone   - Telefone da multiplicar que aparecerá no html   *    * @param {service}  $location      - Usado para fazer requisições. Semelhante ao ajax   * @param {service}  $anchorScroll  - Serviço de scroll do angular   * @param {constant} projectDir     - Local do diretorio do sistema   * @param {service} $window         - Wrapper for window   *    * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   */  function MainController($location, $anchorScroll, projectDir, $window) {    var vm = this;    vm.directory = projectDir;    vm.telefone = '0800 941 5001';    //Atribuicao dos metodos no escopo    vm.Scroll = Scroll;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof MainController     */    function Activate() {      //TODO: Verificar aonde o usuario parou e continuar      console.log($location.protocol());      if ($location.protocol() !== 'https') {        $window.location.href = $location.absUrl().replace('http', 'https');      }    }    /**     * @function Scroll     * @desc Faz rolar a pagina para o local idicado     * @param {string} scrollTo - ID do elemento da tag para a qual a pagina vai     * @memberof MainController     */    function Scroll(scrollTo) {      // set the location.hash to the id of      // the element you wish to scroll to.      $location.hash(scrollTo);      // call $anchorScroll()      $anchorScroll();    }  }})();
(function () {  'use strict';  angular    .module('app')    .controller('PlacaController', PlacaController);  PlacaController.$inject = ['$http', '$rootScope', '$state', 'CheckConditionService', 'api', 'conversorService', 'toaster', 'projectDev'];  /**   * @ngdoc controller   * @scope {}   * @name PlacaController   * @memberof app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Verifica a placa do usuario e recebe o valor da tabela Fipe   *   * @property {object}   vm                 - A named variable for the `this` keyword representing the ViewModel   * @property {json}     consulta           - Dados para consulta na Chekauto   * @property {json}     $rootScope.usuario - Dados do veiculo do usuario   * @property {boolean}  vm.carregando      - Usado para controlar o loading   * @property {boolean}  vm.isTaxi          - Usado para saber se o carro eh um taxi   * @property {boolean}  vm.isUber          - Usado para saber se o carro eh uber   * @property {string}   vm.placa           - Placa do carro   * @property {json}     vm.rejeitados      - Lista de carros rejeitados   *   * @param {service}  $http                   - Usado para comunicação HTTP {@link https://docs.angularjs.org/api/ng/service/$http}   * @param {service}  $rootScope              - Escopo principal do angular {@link https://docs.angularjs.org/api/ng/service/$rootScope}   * @param {service}  $state                  - Status da transição {@link https://github.com/angular-ui/ui-router/wiki/Quick-Reference#state-1}   * @param {service}  CheckConditionService   - Servico para velidação do veículo (Veja fipeService.service.js)   * @param {constant} api                     - url do api   * @param {service}  conversorService        - Converte xml para json e virce versa   * @param {service}  toaster                 - Seviço para mostrar mensagens   * @param {constant} projectDev              - Caminho do diretorio de desenvolvimento   *   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   */  function PlacaController($http, $rootScope, $state, CheckConditionService, api, conversorService, toaster, projectDev) {    var vm = this;    var consulta = {      "xml": {        "CONSULTA": {          "ACESSO": {            "USUARIO": null,            "SENHA"  : null          },          "VEICULO": {            "CHASSI" : null,            "UF"     : null,            "PLACA"  : null,            "RENAVAM": null,            "MOTOR"  : null,            "CRLV"   : null,            "UF_CRLV": null          },          "DADOSPESSOAIS": {            "TIPOPESSOARESTRICOES": null,            "CPFCNPJRESTRICOES"   : null,            "DDD1RESTRICOES"      : null,            "TEL1RESTRICOES"      : null,            "DDD2RESTRICOES"      : null,            "TEL2RESTRICOES"      : null          },          "PERMISSOES": {            "CONTRATOID": null,            "PACOTEID"  : null,            "OPCIONAIS": {              "Precificador": null            }          },          "CONSULTAID"       : null,          "NRCONTROLECLIENTE": null        }      }    };    $rootScope.usuario = {      'codigoTabelaFipe': '',      'data'            : '',      'disel'           : false,      'importado'       : false,      'modelo'          : '',      'preco'           : '',      'taxi'            : false,      'veiculo'         : ''    };    vm.carregando = false;    vm.isTaxi     = false;    vm.isUber     = false;    vm.placa      = '';    vm.rejeitados = [];    /**     * Atribuição das funções no escopo     */    vm.GetDadosRequisicao = GetDadosRequisicao;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof PlacaController     */    function Activate() {      GetRejeitados();    }    /**     * @function fabricante     * @desc Verifica qual é o tipo de veiculo.     * @param {string} fabricante - Nome do fabricante do veiculo     * @param {string} combustivel - Tipo de compustivel do veiculo     * @memberof PlacaController     */    function CheckTipoCarro(fabricante, combustivel) {      combustivel = combustivel.toUpperCase();      // Verifica se eh taxi.      if (vm.isUber) {        console.log('Carro é taxi');        $rootScope.usuario.taxi = true;      } else {        $rootScope.usuario.taxi = false;      }      // Verificar se o carro eh a disel      if (combustivel.indexOf('DISEL') !== -1) {        console.log('Carro é a disel');        $rootScope.usuario.disel = true;      } else {        $rootScope.usuario.disel = false;      }      // Verifica se o carro eh importado      $http.get(api + 'importado?filter=nome,eq,' + fabricante).then(function (resp) {        var retorno = php_crud_api_transform(resp.data).importado;        if (retorno.length > 0) {          console.log('Carro é importado');          $rootScope.usuario.importado = true;        } else {          $rootScope.usuario.importado = false;        }        console.log($rootScope.usuario);        vm.carregando = false;        $state.go('cotacao');      }).catch(function (error) {        // Erro na conexao        vm.carregando = false;        toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao comparar com os importados = >' + error);      });    }    /**     * @function GetDadosRequisicao     * @desc Pega os dados para a autorização da consulta, coloca-os no json consulta e depois executa PesquisarPlaca     * @memberof PlacaController     */    function GetDadosRequisicao() {      vm.carregando = true;      /**       * Pega os dados para fazer a requisição.       * Eles ficam no PHP para dificultar a visualização de pessoas nao autorizadas.       */      $http({        method: 'GET',        url: projectDev + 'php/dados.php'      }).then(function (resp) {        consulta.xml.CONSULTA.ACESSO.SENHA          = resp.data.senha;        consulta.xml.CONSULTA.ACESSO.USUARIO        = resp.data.usuario;        consulta.xml.CONSULTA.PERMISSOES.CONTRATOID = resp.data.contrato;        consulta.xml.CONSULTA.PERMISSOES.PACOTEID   = resp.data.pacote;        PesquisarPlaca(resp.data.url);      }).catch(function (error) {        vm.carregando = false;        $state.go('fipe');        console.warn('Erro ao pegar os dados de consulta = >' + error);      });    }    /**     * @function GetRejeitados     * @desc Pega os veiculos rejeitados no banco de dados     * @memberof PlacaController     */    function GetRejeitados() {      $http.get(api + 'rejeitado').then(function (resp) {        vm.rejeitados = php_crud_api_transform(resp.data).rejeitado;      }).catch(function (error) {        vm.carregando = false;        toaster.pop({          type   : 'error',          title  : 'Erro #701',          body   : 'Não foi possível completar a requisição.',          timeout: 50000        });        console.warn('Erro ao pegar os rejeitados = >', error);      });    }    /**     * @function PesquisarPlaca     * @desc Armazena a plca do usuario no json consulta, converte json para xml, pois o serviço     * só aceita xml e envia a requisição.     * @param {string} url - url do sistema Chekauto para requisição     * @memberof PlacaController     */    function PesquisarPlaca(url) {      var xml = '';      consulta.xml.CONSULTA.VEICULO.PLACA = vm.placa;      xml = conversorService.Json2Xml(consulta);      $.get(url + xml, function (data) {        var ano                 = '';                      // Ano do modelo        var combustivel         = '';                      // Tipo de combustivel do veiculo        var codigoConsulta      = '';                      // Usado para validar a consulta        var codigoDecodificador = '';                      // Usado para validar a segunda consulta        var fabricante          = '';                      // Fabricante do veiculo        var fipe                = '';                      // Armazena os dados da tabela fipe        var isValido            = true;                    // Usado para validar o processo todo        var modelo              = '';                      // Modelo do veiculo        var retorno             = $(data).find('string');  // Recebe a resposta do servico        var testeAno            = '';                      // Usado para verificar se o ano eh aceito        var testeModelo         = '';                      // Usado para verificar se o modelo eh aceito        var veiculo             = '';                      // Usado para ver qual o tipo de veiculo (moto ou carro)        retorno = $.parseXML(retorno[0].textContent); // Converte string xml para objeto xml        console.log(retorno);        try {          codigoConsulta      = $(retorno).find('Precificador').find('CodigoRetorno')[0].textContent || null;          codigoDecodificador = $(retorno).find('AgregadoCompleto').find('CodigoRetorno')[0].textContent || null;        } catch (error) {          console.warn('Erro na consulta =>', error);          codigoConsulta      =  null;          codigoDecodificador =  null;        }        console.log('Codigo Consulta => ', codigoConsulta);        console.log('Codigo Decodificador => ', codigoDecodificador);        //Se a consulta falhou envia o usuario para a preencher os dados do carro        if (codigoConsulta !== '1' || codigoDecodificador !== '1') {          console.info('Consulta falhou');          vm.carregando = false;          $state.go('fipe');        } else { // Dados Encontrados          console.info('Consulta deu certo');          var marcaModelo = $(retorno).find('AgregadoCompleto').find('MarcaModelo')[0].textContent || null;          ano         = $(retorno).find('AgregadoCompleto').find('AnoModelo')[0].textContent || null;          combustivel = $(retorno).find('AgregadoCompleto').find('Combustivel')[0].textContent || 'GASOLINA';          veiculo     = $(retorno).find('AgregadoCompleto').find('TipoVeiculo')[0].textContent || null;          console.log('Ano => ', ano);          console.log('Combustivel => ', combustivel);          console.log('Veiculo => ', veiculo);          if (!marcaModelo && !ano && !veiculo) {            /**             * Nao foi possivel encontrar alguma informacao             * portando o usuario esta sendo mandado para procurar os dados do carro             */            console.info('Alguma informação não foi encontrada');            vm.carregando = false;            $state.go('fipe');          } else {            console.info('Tudo certo');            //Formata os dados para ficar mais facil a busca            veiculo     = veiculo.toUpperCase();            marcaModelo = marcaModelo.split('/');            fabricante  = marcaModelo[0];            modelo      = marcaModelo[1];            //Salva os dados do usuario            $rootScope.usuario.data             = $(retorno).find('DataHoraConsulta')[0].textContent;            $rootScope.usuario.codigoTabelaFipe = $(retorno).find('Precificador').find('CodigoFipe')[0].textContent;            $rootScope.usuario.modelo           = modelo;            $rootScope.usuario.preco            = 'R$ ' + $(retorno).find('Precificador').find('Valor')[0].textContent + ',00';            $rootScope.usuario.veiculo          = veiculo;            console.log('Dados do usuario => ', $rootScope.usuario);            //Startup o servico para verificar se o veiculo eh aceito            CheckConditionService.Activate(modelo, fabricante, ano, vm.rejeitados);            if (veiculo === 'AUTOMOVEL') { // Se o veiculo for carro              console.info('Carro');              testeAno    = CheckConditionService.CarHasValidYear();   //Valida o ano              testeModelo = CheckConditionService.CarHasValidModel();  //Valida o modelo              console.log('Ano teste => ', testeAno);              console.log('Modelo teste => ', testeModelo);              if (!testeAno || !testeModelo) {                /**                 * O ano ou modelo foi rejeitado                 * Nao eh possivel fazer cotacao para esse veiculo                 */                vm.carregando = false;                toaster.pop({                  type   : 'error',                  title  : 'Atenção!',                  body   : 'Não é possível fazer cotação para esse veículo.',                  timeout: 50000                });              } else { // Modelo e ano aceitos                /**                 * Se o usuario nao marcou se o carro eh taxi ou uber                 * eh necessario verificar se o veiculo eh importado                 * se for o carro eh especial                 */                fabricante = fabricante.toUpperCase();                CheckTipoCarro(fabricante, combustivel);              }            } else if (veiculo === 'MOTOCICLETA') { // Se o veiculo eh moto              console.info('Moto');              testeAno    = CheckConditionService.MotoHasValidYear();              testeModelo = CheckConditionService.MotoHasValidYear();              console.log('Ano teste => ', testeAno);              console.log('Modelo teste => ', testeModelo);              if (!testeAno || !testeModelo) {                console.info('Alguma informação não foi encontrada');                /**                 * O ano ou modelo foi rejeitado                 * Nao eh possivel fazer cotacao para esse veiculo                 */                vm.carregando = false;                toaster.pop({                  type   : 'error',                  title  : 'Atenção!',                  body   : 'Não é possível fazer cotação para esse veículo.',                  timeout: 50000                });              } else {                vm.carregando = false;                $state.go('cotacao');              }            } else {              console.info('Nem carro nem moto');              /**               * Se o veiculo nao for moto nem carro envio o usuario para escolher               * os dados do veiculo               */              vm.carregando = false;              $state.go('fipe');            }          }        }      });    }  }})();
(function () {  'use strict';  angular    .module('app')    .controller('SemPlacaController', SemPlacaController);  SemPlacaController.$inject = ['$http', '$rootScope', '$state', 'CheckConditionService', 'api', 'fipeService', 'toaster'];  /**   * @ngdoc controller   * @scope {}   * @name SemPlacaController   * @memberof app   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Force opções de veiculos para o usuario escolher a que se adequa a ele e retornar o valor na tabela Fipe   *   * @property {object}   vm                  - A named variable for the `this` keyword representing the ViewModel   * @property {json}     $rootScope.usuario  - Dados do veiculo do usuario   * @property {string}   vm.anoEscolhido     - Ano do veiculo   * @property {boolean}  vm.carregando       - Usado para controlar o loading   * @property {string}   vm.fipePasso        - Usado para controlar as telas que aparecem   * @property {string}   vm.isUber           - Usado para saber se o carro eh uber   * @property {json}     vm.listaAnos        - Lista dos anos do modelo escolhido   * @property {json}     vm.listaCarros      - Lista de carros para escolher   * @property {json}     vm.listaModelos     - Lista de modelos de veiculos   * @property {json}     vm.listaMotos       - Lista de motos   * @property {string}   vm.marcaEscolhida   - Fabricante do veiculo escolhido   * @property {string}   vm.modeloEscolhido  - Modelo do fabricante escolhido   * @property {string}   vm.veiculo          - Veiculo escolhido   * @property {json}     vm.rejeitados       - Lista de carros rejeitados   *   * @param {service}  $http                   - Usado para comunicação HTTP {@link https://docs.angularjs.org/api/ng/service/$http}   * @param {service}  $rootScope              - Escopo principal do angular {@link https://docs.angularjs.org/api/ng/service/$rootScope}   * @param {service}  $state                  - Status da transição {@link https://github.com/angular-ui/ui-router/wiki/Quick-Reference#state-1}   * @param {service}  CheckConditionService   - Servico para velidação do veículo (Veja fipeService.service.js)   * @param {constant} api                     - url do api   * @param {service}  fipeService             - Serviço para consulta na tabela fipe   * @param {service}  toaster                 - Seviço para mostrar mensagens   *   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   */  function SemPlacaController($http, $rootScope, $state, CheckConditionService, api, fipeService, toaster) {    var vm = this;    $rootScope.usuario = {      'codigoTabelaFipe': '',      'data'            : '',      'disel'           : false,      'importado'       : false,      'modelo'          : '',      'preco'           : '',      'taxi'            : false,      'veiculo'         : ''    };    vm.anoEscolhido    = '';    vm.carregando      = true;    vm.fipePasso       = 'passo1';    vm.isUber          = false;    vm.listaAnos       = [];    vm.listaCarros     = [];    vm.listaModelos    = [];    vm.listaMotos      = [];    vm.marcaEscolhida  = '';    vm.modeloEscolhido = '';    vm.veiculo         = '';    vm.rejeitados      = [];    /**     * Atribuição das funções no escopo     */    vm.GetAnos    = GetAnos;    vm.GetModelos = GetModelos;    vm.GetPreco   = GetPreco;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof SemPlacaController     */    function Activate() {      GetRejeitados();      fipeService.GetMotos().then(function (resp) {        vm.listaMotos = resp;        console.log('Motos carregadas =>', vm.listaMotos);      });      fipeService.GetCarros().then(function (resp) {        vm.listaCarros = resp;        console.log('Carros carregados =>', vm.listaCarros);        vm.carregando = false;      });    }    /**     * @function GetAnos     * @desc Busca os anos do modelo escolhido. Sai do passo3 e vai para o passo4     * @memberof SemPlacaController     */    function GetAnos() {      console.info('Passo 3');      vm.carregando = true;      fipeService.Consultar(vm.veiculo + '/marcas/' + vm.marcaEscolhida + '/modelos/' + vm.modeloEscolhido + '/anos').then(function (resp) {        vm.listaAnos  = resp;        console.log('Anos =>', vm.listaAnos);        vm.carregando = false;        vm.fipePasso  = 'passo4';      }).catch(function (error) {        toaster.pop({         type   : 'error',         title  : 'Erro #802',         body   : 'Não foi possível completar a requisição.',         timeout: 50000       });       console.warn('Passo 3 = >' + error);     });    }    /**     * @function GetModelos     * @desc Busca os modelos baseado no veiculo e fabricante escolhidos. Sai do passo2 e vai para o passo3     * @memberof SemPlacaController     */    function GetModelos() {      console.info('Passo 2');      vm.carregando = true;      //Pega o veiculo escolhido(moto ou carro) e o modelo escolhido (atraves da lista de um dos dois) e envia a requisicao      fipeService.Consultar(vm.veiculo + '/marcas/' + vm.marcaEscolhida + '/modelos').then(function (resp) {        vm.listaModelos = resp.modelos;        console.log('Modelos =>', vm.listaModelos);        if (vm.veiculo === 'carros') {          $rootScope.usuario.veiculo = 'AUTOMOVEL';        } else {          $rootScope.usuario.veiculo = 'MOTOCICLETA';        }        console.log('Veiculo =>', $rootScope.usuario.veiculo);        vm.fipePasso  = 'passo3';        vm.carregando = false;      }).catch(function (error) {        toaster.pop({         type   : 'error',         title  : 'Erro #802',         body   : 'Não foi possível completar a requisição.',         timeout: 50000       });       console.warn('Erro passo2 = >' + error);     });    }    /**     * @function GetPreco     * @desc Ultimo passo antes de mostrar a cotação. Busca o valor na tabela fipe, verifica se o modelo é aceitavel     * @memberof SemPlacaController     */    function GetPreco() {      console.info('Passo 4');      vm.carregando   = true;      var testeAno    = '';      var testeModelo = '';      fipeService.Consultar(vm.veiculo + '/marcas/' + vm.marcaEscolhida + '/modelos/' + vm.modeloEscolhido + '/anos/' + vm.anoEscolhido).then(function (resp) {        var combustivel = resp.Combustivel;        //Armazena os dados da consulta para mostrar na tela de cotacao        $rootScope.usuario.preco            = resp.Valor;        $rootScope.usuario.preco            = $rootScope.usuario.preco.replace('R$ ','').replace('.','').replace(',00','');        $rootScope.usuario.modelo           = resp.Modelo;        $rootScope.usuario.codigoTabelaFipe = resp.CodigoFipe;         console.log('Preco =>', resp);        CheckConditionService.Activate(resp.Modelo, resp.Marca, resp.AnoModelo, vm.rejeitados);        if ($rootScope.usuario.veiculo === 'AUTOMOVEL') {          console.info('Carro');          testeAno    = CheckConditionService.CarHasValidYear(); //Valida o ano          testeModelo = CheckConditionService.CarHasValidModel(); //Valida o modelo          console.log('Teste Ano =>', testeAno);          console.log('Teste Modelo =>', testeModelo);          if (!testeAno || !testeModelo) {            console.warn('Carro Invalido');            vm.carregando = false;            toaster.pop({              type:    'error',              title:   'Atenção!',              body:    'Não é possível fazer cotação para esse veículo.',              timeout: 50000            });          }else{            if (vm.isUber) {              console.info('Taxi');              $rootScope.usuario.taxi = true;              $state.go('cotacao');            }else if(combustivel.toUpperCase() === 'DISEL'){               console.info('Disel');              $rootScope.usuario.disel = true;              $state.go('cotacao');            } else {              $http.get(api + 'importado?filter=nome,eq,' + resp.Marca).then(function (resp) {                var retorno = php_crud_api_transform(resp.data).importado;                if (retorno.length > 0) {                   console.info('Importado');                  $rootScope.usuario.importado = true;                }                $state.go('cotacao');              });            }          }        } else if ($rootScope.usuario.veiculo === 'MOTOCICLETA') {          console.info('Moto');          testeAno    = CheckConditionService.MotoHasValidYear();          testeModelo = CheckConditionService.MotoHasValidYear();          console.log('Teste Ano =>', testeAno);          console.log('Teste Modelo =>', testeModelo);          if (!testeAno || !testeModelo) {            console.warn('Moto Invalida');            vm.carregando = false;            toaster.pop({              type:    'error',              title:   'Atenção!',              body:    'Não é possível fazer cotação para esse veículo.',              timeout: 50000            });          }else{            $state.go('cotacao');          }        }      }).catch(function (error) {        toaster.pop({         type   : 'error',         title  : 'Erro #802',         body   : 'Não foi possível completar a requisição.',         timeout: 50000       });       console.warn('Erro passo 4 = >' + error);     });    }    /**     * @function GetRejeitados     * @desc Busca no banco de dados os veiculos rejeitados     * @memberof SemPlacaController     */    function GetRejeitados() {      $http.get(api + 'rejeitado').then(function (resp) {        vm.rejeitados = php_crud_api_transform(resp.data).rejeitado;      });    }  }})();
(function () {  'use strict';  /**   * @memberof app   * @ngdoc directive   * @name focusMe   *   * @param {service} $q - promise   * @desc Faz o cursor fcar no input   *    * @see [Referencia] {@link https://stackoverflow.com/questions/14833326/how-to-set-focus-on-input-field}   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/directive} Para mais informacoes   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#directives} Para melhores praticas   */  angular    .module('app')    .directive('focusMe', focusMe);  focusMe.$inject = [];  function focusMe() {    var directive = {      link: link,      scope: {        trigger: '=focusMe'      }    };    return directive;    function link(scope, element) {      scope.$watch('trigger', function (value) {        if (value === true) {          element[0].focus();          scope.trigger = false;        }      });    }  }})();
(function () {  'use strict';  angular    .module('app')    .factory('consultCEP', consultCEP);  consultCEP.$inject = ['$q', '$http'];  /**   * @memberof app   * @ngdoc factory   * @scope {}   * @name cep   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @param {service} $q - promise   * @desc ServiÃ§o de consulta de CEP   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/providers#factory-recipe} Para mais informaÃ§Ãµes   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#factories} Para melhores praticas   */  function consultCEP($q, $http) {    return {      consultar: Consultar    };    /**     * @function Consultar     * @desc Consulta o cep fornecido e retorna os dados do local     * @see {@link http://postmon.com.br/}     * @param {String} cepToConsult - CEP para consultar     * @memberof consultCEP     */    function Consultar(cepToConsult) {      var cep = cepToConsult.replace(/\./g, '');      cep = cep.replace(/\-/g, '');      var deferred = $q.defer();      if (cep.length > 7) {        var call = $.ajax({          url: 'https://api.postmon.com.br/v1/cep/' + cep        });        call.then(function successCallback(response) {          deferred.resolve(response);        }, function errorCallback(response) {          deferred.reject(arguments);        });        return deferred.promise;      } else {        return '';      }    }  }}());
(function () {  'use strict';  angular    .module('app')    .factory('CheckConditionService', CheckConditionService);  CheckConditionService.$inject = ['anoCarro', 'anoMoto'];  /**   * @memberof app   * @ngdoc factory   * @scope {}   * @name CheckConditionService   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Serviço para checar se o carro ou a moto eh valido   *    * @param {constant} anoCarro  - ano do carro para validação   * @param {constant} anoMoto   - ano da moto para validação   *    * TODO: Validar modelos de motos   *    * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/providers#factory-recipe} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#factories} Para melhores praticas   */  function CheckConditionService(anoCarro, anoMoto) {    var ano        = '';    var fabricante = '';    var modelo     = '';    var rejeitados = [];    var service = {      Activate:          Activate,      CarHasValidModel:  CarHasValidModel,      CarHasValidYear:   CarHasValidYear,      MotoHasValidModel: MotoHasValidModel,      MotoHasValidYear:  MotoHasValidYear    };    return service;    ////////////////    /**     * @function Activate     * @desc Construtor do service.      * @param {string} modelo - modelo do veiculo     * @param {string} fabricante - fabricante do veiculo     * @param {string} ano - ano do veiculo     * @param {json}   rej - lista de veiculos rejeitados     * @memberof CheckConditionService     */    function Activate(modelo, fabricante, ano, rej) {      this.ano        = ano;      this.fabricante = fabricante;      this.modelo     = modelo;      this.rejeitados = rej;    }    /**     * @function CarHasValidModel     * @desc Verifica se o modelo do carro eh valido     * @return {boolean}      * @memberof CheckConditionService     */    function CarHasValidModel() {      var retorno = true;      switch (this.fabricante.toUpperCase()) {        case 'AUDI':          retorno = (parseInt(this.ano) > 2008);          break;        case 'BMW':          retorno = (parseInt(this.ano) > 2008);          break;        case 'FIAT':          retorno = (parseInt(this.ano) > 2000);          break;        case 'FORD':          retorno = (parseInt(this.ano) > 2000);          break;        case 'GM - CHEVROLET':          retorno = (parseInt(this.ano) > 2000);          break;        case 'HONDA':          retorno = (parseInt(this.ano) > 2002);          break;        case 'HYUNDAI':          retorno = (parseInt(this.ano) > 2008);          break;        case 'JAC MOTORS':          retorno = (parseInt(this.ano) > 2008);          break;        case 'KIA MOTORS':          retorno = (parseInt(this.ano) > 2008);          break;        case 'MERCEDES':          retorno = (parseInt(this.ano) > 2008);          break;        case 'MITSUBISHI':          retorno = (parseInt(this.ano) > 2009);          break;        case 'NISSAN':          retorno = (parseInt(this.ano) > 2007);          break;        case 'TOYOTA':          retorno = (parseInt(this.ano) > 2003);          break;        case 'VM - VOLKSWAGEN':          retorno = (parseInt(this.ano) > 2000);          break;        case 'VOLVO':          retorno = (parseInt(this.ano) > 2008);          break;        default:          retorno = true;          break;      }      if (retorno) {        angular.forEach(rejeitados, function (value, key) {          if (value.Fabricante.toUpperCase() === this.fabricante.toUpperCase()) {            var modeloTeste     = this.modelo;            var modeloRejeitado = value.Modelo;            modeloTeste     = modeloTeste.toUpperCase();            modeloRejeitado = modeloRejeitado.toUpperCase();            if (modeloTeste.includes(modeloRejeitado)) {              retorno = false;            }          }        });      }      return retorno;    }    /**     * @function CarHasValidYear     * @desc Verifica se o ano do carro eh valido     * @return {boolean}     * @memberof CheckConditionService     */    function CarHasValidYear() {      var yearsApart = new Date(new Date() - new Date(this.ano + '-01-01')).getFullYear() - 1970;      return (yearsApart &lt; anoCarro);    }    /**     * @function MotoHasValidModel     * @desc Verifica se o modelo da moto eh valido     * @return {boolean}     * @memberof CheckConditionService     */    function MotoHasValidModel() {      return true;    }    /**     * @function MotoHasValidYear     * @desc Verifica se o ano da moto eh valido     * @return {boolean}      * @memberof CheckConditionService     */    function MotoHasValidYear() {      return (parseInt(this.ano) > anoMoto);    }  }})();
(function () {  'use strict';  angular    .module('app')    .service('conversorService', conversorService);  /**   * @ngdoc service   * @scope {}   * @name conversorService   * @memberof app   * @author  Stefan Goessner   * @license Creative Commons GNU LGPL   * @version 0.9   * @desc Faz a transformaÃ§Ã£o entre xml e json   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informaÃ§Ãµes   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   * @see License               {@link http://creativecommons.org/licenses/LGPL/2.1/}   * @see Author site           {@link  http://goessner.net/}   */  function conversorService() {    this.Json2Xml = Json2Xml;    this.Xml2Json = Xml2Json;    ////////////////    /**     * @function Json2Xml     * @desc Consulta o cep fornecido e retorna os dados do local     * @param {object} o - javascript object     * @param {String} tab - tab or indent string for pretty output formatting.Omit or use empty string "" to supress.     * @return {xml} xml string     * @memberof conversorService     */    function Json2Xml(o, tab) {      o = angular.fromJson(o);      var toXml = function (v, name, ind) {          var xml = "";          if (v instanceof Array) {            for (var i = 0, n = v.length; i &lt; n; i++)              xml += ind + toXml(v[i], name, ind + "\t") + "\n";          } else if (typeof (v) == "object") {            var hasChild = false;            xml += ind + "&lt;" + name;            for (var m in v) {              if (m.charAt(0) == "@")                xml += " " + m.substr(1) + "=\"" + v[m].toString() + "\"";              else                hasChild = true;            }            xml += hasChild ? ">" : "/>";            if (hasChild) {              for (var m in v) {                if (m == "#text")                  xml += v[m];                else if (m == "#cdata")                  xml += "&lt;![CDATA[" + v[m] + "]]>";                else if (m.charAt(0) != "@")                  xml += toXml(v[m], m, ind + "\t");              }              xml += (xml.charAt(xml.length - 1) == "\n" ? ind : "") + "&lt;/" + name + ">";            }          } else {            xml += ind + "&lt;" + name + ">" + v.toString() + "&lt;/" + name + ">";          }          return xml;        },        xml = "";      for (var m in o)        xml += toXml(o[m], m, "");      return tab ? xml.replace(/\t/g, tab) : xml.replace(/\t|\n/g, "");    }    /**     * @function String2Object     * @desc transofrma um xml string em xml object     * @param {String} xml - xml string     * @return {xml}     * @memberof conversorService     */    function String2Object(xml) {      var parseXml;      if (window.DOMParser) {        parseXml = function (xmlStr) {          return (new window.DOMParser()).parseFromString(xmlStr, 'text/xml');        };      } else if (typeof window.ActiveXObject != 'undefined' && new window.ActiveXObject('Microsoft.XMLDOM')) {        parseXml = function (xmlStr) {          var xmlDoc = new window.ActiveXObject('Microsoft.XMLDOM');          xmlDoc.async = 'false';          xmlDoc.loadXML(xmlStr);          return xmlDoc;        };      } else {        parseXml = function () {          return null;        }      }      return parseXml(xml);    }    /**     * @function Xml2Json     * @desc Consulta o cep fornecido e retorna os dados do local     * @param {xml} xml - element or document DOM node     * @param {String} tab - tab or indent string for pretty output formatting.Omit or use empty string "" to supress.     * @return {json} json string     * @memberof conversorService     */    function Xml2Json(xml, tab) {      xml = String2Object(xml); //converte de string para objeto      var X = {        toObj: function (xml) {          var o = {};          if (xml.nodeType == 1) { // element node ..            if (xml.attributes.length) // element with attributes  ..              for (var i = 0; i &lt; xml.attributes.length; i++)                o["@" + xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue || "").toString();            if (xml.firstChild) { // element has child nodes ..              var textChild = 0,                cdataChild = 0,                hasElementChild = false;              for (var n = xml.firstChild; n; n = n.nextSibling) {                if (n.nodeType == 1) hasElementChild = true;                else if (n.nodeType == 3 && n.nodeValue.match(/[^ \f\n\r\t\v]/)) textChild++; // non-whitespace text                else if (n.nodeType == 4) cdataChild++; // cdata section node              }              if (hasElementChild) {                if (textChild &lt; 2 && cdataChild &lt; 2) { // structured element with evtl. a single text or/and cdata node ..                  X.removeWhite(xml);                  for (var n = xml.firstChild; n; n = n.nextSibling) {                    if (n.nodeType == 3) // text node                      o["#text"] = X.escape(n.nodeValue);                    else if (n.nodeType == 4) // cdata node                      o["#cdata"] = X.escape(n.nodeValue);                    else if (o[n.nodeName]) { // multiple occurence of element ..                      if (o[n.nodeName] instanceof Array)                        o[n.nodeName][o[n.nodeName].length] = X.toObj(n);                      else                        o[n.nodeName] = [o[n.nodeName], X.toObj(n)];                    } else // first occurence of element..                      o[n.nodeName] = X.toObj(n);                  }                } else { // mixed content                  if (!xml.attributes.length)                    o = X.escape(X.innerXml(xml));                  else                    o["#text"] = X.escape(X.innerXml(xml));                }              } else if (textChild) { // pure text                if (!xml.attributes.length)                  o = X.escape(X.innerXml(xml));                else                  o["#text"] = X.escape(X.innerXml(xml));              } else if (cdataChild) { // cdata                if (cdataChild > 1)                  o = X.escape(X.innerXml(xml));                else                  for (var n = xml.firstChild; n; n = n.nextSibling)                    o["#cdata"] = X.escape(n.nodeValue);              }            }            if (!xml.attributes.length && !xml.firstChild) o = null;          } else if (xml.nodeType == 9) { // document.node            o = X.toObj(xml.documentElement);          } else            alert("unhandled node type: " + xml.nodeType);          return o;        },        toJson: function (o, name, ind) {          var json = name ? ("\"" + name + "\"") : "";          if (o instanceof Array) {            for (var i = 0, n = o.length; i &lt; n; i++)              o[i] = X.toJson(o[i], "", ind + "\t");            json += (name ? ":[" : "[") + (o.length > 1 ? ("\n" + ind + "\t" + o.join(",\n" + ind + "\t") + "\n" + ind) : o.join("")) + "]";          } else if (o == null)            json += (name && ":") + "null";          else if (typeof (o) == "object") {            var arr = [];            for (var m in o)              arr[arr.length] = X.toJson(o[m], m, ind + "\t");            json += (name ? ":{" : "{") + (arr.length > 1 ? ("\n" + ind + "\t" + arr.join(",\n" + ind + "\t") + "\n" + ind) : arr.join("")) + "}";          } else if (typeof (o) == "string")            json += (name && ":") + "\"" + o.toString() + "\"";          else            json += (name && ":") + o.toString();          return json;        },        innerXml: function (node) {          var s = ""          if ("innerHTML" in node)            s = node.innerHTML;          else {            var asXml = function (n) {              var s = "";              if (n.nodeType == 1) {                s += "&lt;" + n.nodeName;                for (var i = 0; i &lt; n.attributes.length; i++)                  s += " " + n.attributes[i].nodeName + "=\"" + (n.attributes[i].nodeValue || "").toString() + "\"";                if (n.firstChild) {                  s += ">";                  for (var c = n.firstChild; c; c = c.nextSibling)                    s += asXml(c);                  s += "&lt;/" + n.nodeName + ">";                } else                  s += "/>";              } else if (n.nodeType == 3)                s += n.nodeValue;              else if (n.nodeType == 4)                s += "&lt;![CDATA[" + n.nodeValue + "]]>";              return s;            };            for (var c = node.firstChild; c; c = c.nextSibling)              s += asXml(c);          }          return s;        },        escape: function (txt) {          return txt.replace(/[\\]/g, "\\\\")            .replace(/[\"]/g, '\\"')            .replace(/[\n]/g, '\\n')            .replace(/[\r]/g, '\\r');        },        removeWhite: function (e) {          e.normalize();          for (var n = e.firstChild; n;) {            if (n.nodeType == 3) { // text node              if (!n.nodeValue.match(/[^ \f\n\r\t\v]/)) { // pure whitespace text node                var nxt = n.nextSibling;                e.removeChild(n);                n = nxt;              } else                n = n.nextSibling;            } else if (n.nodeType == 1) { // element node              X.removeWhite(n);              n = n.nextSibling;            } else // any other node              n = n.nextSibling;          }          return e;        }      };      if (xml.nodeType == 9) // document node        xml = xml.documentElement;      var json = X.toJson(X.toObj(X.removeWhite(xml)), xml.nodeName, "\t");      return "{\n" + tab + (tab ? json.replace(/\t/g, tab) : json.replace(/\t|\n/g, "")) + "\n}";    }  }})();
(function () {  'use strict';  angular    .module('app')    .factory('fipeService', fipeService);  fipeService.$inject = ['$q'];  /**   * @memberof app   * @ngdoc factory   * @scope {}   * @name fipeService   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Serviço de consulta da tabela fipe   *    * @param {service} $q - promise   *    * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/providers#factory-recipe} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#factories} Para melhores praticas   */  function fipeService($q) {    var url = 'https://fipe-parallelum.rhcloud.com/api/v1/';    return {      Consultar: Consultar,      GetCarros: GetCarros,      GetMotos:  GetMotos    };    /**     * @function Consultar     * @desc Consulta a tabela fipe     * @see {@link https://fipeapi.appspot.com/}     * @param {String} endpoint - final da consulta ao serviço     * @return {promise} resultado da consulta     * @memberof fipeService     */    function Consultar(endpoint) {      var deferred = $q.defer();      var call = $.ajax({        url: url + endpoint      });      call.then(function successCallback(response) {        deferred.resolve(response);      }, function errorCallback(response) {        deferred.reject(arguments);      });      return deferred.promise;    }    /**     * @function GetCarros     * @desc Busca todos as fabricantes de carros     * @return {promise} lista de fabricantes de carros     * @memberof fipeService     */    function GetCarros() {      var deferred = $q.defer();      var call = $.ajax({        url: url + 'carros/marcas'      });      call.then(function successCallback(response) {        deferred.resolve(response);      }, function errorCallback(response) {        deferred.reject(arguments);      });      return deferred.promise;    }    /**     * @function GetCarros     * @desc Busca todos as fabricantes de motos     * @return {promise} lista de fabricantes de motos     * @memberof fipeService     */    function GetMotos() {      var deferred = $q.defer();      var call = $.ajax({        url: url + 'motos/marcas'      });      call.then(function successCallback(response) {        deferred.resolve(response);      }, function errorCallback(response) {        deferred.reject(arguments);      });      return deferred.promise;    }  }}());</code></pre>        </article>        <!-- index.html -->        <!-- class files -->      </div>      <footer style="clear:both">        Documentation generated by        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>        using        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>      </footer>    </div>    <script src="js/prettify.js"></script>    <script src="js/angular.min.js"></script>    <script src="js/site.js"></script>    <!--%= prettyJson %-->    <script>      prettyPrint();      var lineNo = window.location.hash.match(/#line([0-9]+)$/);      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();    </script>  </body></html>